<!doctype html><html lang=zh><head><title>ARCH安装指北</title>
<meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=5" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><link rel=icon href=https://laeo.github.io/favicon.ico><script src=/js/toc.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script src=/vendor/js/md5.min.js></script><script>var gitalk=new Gitalk({clientID:"bcb3ff802edb45ae15c3",clientSecret:"541b0675cacbdad87ef5e31dcff14d28f843b34a",repo:"laeo.github.io",owner:"laeo",admin:["laeo"],id:md5(location.pathname),distractionFreeMode:"false"});window.onload=function(){gitalk.render("gitalk-container")}</script></head><body><div id=app><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><div class=toc><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e5%88%b6%e4%bd%9c%e5%ae%89%e8%a3%85%e7%9b%98 class=nav-制作安装盘>制作安装盘</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e5%ae%89%e8%a3%85%e7%8e%af%e5%a2%83 class=nav-设置安装环境>设置安装环境</a></li><li><a href=#%e7%a1%ac%e7%9b%98%e5%88%86%e5%8c%ba class=nav-硬盘分区>硬盘分区</a></li><li><a href=#%e5%ae%89%e8%a3%85%e5%9f%ba%e7%a1%80%e7%b3%bb%e7%bb%9f class=nav-安装基础系统>安装基础系统</a></li><li><a href=#%e5%88%9d%e5%a7%8b%e5%8c%96%e7%b3%bb%e7%bb%9f class=nav-初始化系统>初始化系统</a></li><ul><li><a href=#%e5%ae%89%e8%a3%85-uefi-%e5%bc%95%e5%af%bc class=nav-安装-uefi-引导>安装 UEFI 引导</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e4%b8%bb%e6%9c%ba%e5%90%8d class=nav-设置主机名>设置主机名</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e6%97%b6%e5%8c%ba class=nav-设置时区>设置时区</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e4%b8%aa%e4%ba%ba%e8%b4%a6%e6%88%b7 class=nav-创建个人账户>创建个人账户</a></li><li><a href=#%e4%bf%ae%e6%94%b9%e7%99%bb%e5%bd%95%e5%af%86%e7%a0%81 class=nav-修改登录密码>修改登录密码</a></li><li><a href=#%e5%ae%89%e8%a3%85%e5%9f%ba%e7%a1%80%e7%a8%8b%e5%ba%8f class=nav-安装基础程序>安装基础程序</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e8%b4%a6%e6%88%b7%e6%9d%83%e9%99%90 class=nav-设置账户权限>设置账户权限</a></li><li><a href=#%e9%87%8d%e5%90%af%e7%b3%bb%e7%bb%9f class=nav-重启系统>重启系统</a></li></ul><li><a href=#%e5%85%b6%e5%ae%83 class=nav-其它>其它</a></li><ul><li><a href=#%e5%ae%89%e8%a3%85%e6%a1%8c%e9%9d%a2%e7%8e%af%e5%a2%83 class=nav-安装桌面环境>安装桌面环境</a></li><li><a href=#%e8%8b%b1%e4%bc%9f%e8%be%be%e6%98%93%e7%88%86%e7%82%b8 class=nav-英伟达易爆炸>英伟达“易爆炸”</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu
</i></button>
<a id=navTitle class=navbar-brand href=https://laeo.github.io/>LAEO
</a><button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://laeo.github.io/><div class=single-column-header-title>LAEO</div><div class=single-column-header-subtitle>桀桀桀</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>ARCH安装指北<div class=post-meta><time itemprop=datePublished>2018-06-13 00:00
</time><i class=material-icons>schedule</i>
7 min
22 s.</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h2 id=制作安装盘>制作安装盘</h2><p>首先去 ARCH 官网 <a href=https://www.archlinux.org/download/>下载</a> 最新版本的 ISO 镜像文件。</p><p>下载好后，使用启动盘制作工具制作U盘启动盘，制作工具推荐 <a href=https://rufus.ie>rufus</a>。</p><h2 id=设置安装环境>设置安装环境</h2><p>开机选择 U盘 进行引导，大部分情况下即可正常进入到命令行模式的安装环境了。</p><blockquote><p>ARCH 安装环境并没有图形界面，因为安装非常简单。</p></blockquote><p>安装需要联网下载系统依赖包，我这里使用 WIFI 进行联网。</p><p>在终端执行 <code>wifi-menu</code> 进入简单的图形界面，选择要连接的 WIFI 名称，点击回车后输入密码，稍等片刻即可连接成功。</p><blockquote><p>可以使用 <code>ping -c4 www.baidu.com</code> 确定联网是否成功。</p></blockquote><p>联网成功后，执行 <code>pacman -Syy</code> 同步包管理数据，然后执行 <code>pacman -S reflector</code> 安装用于筛选软件源的工具。</p><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>reflector -c CN -l <span style=color:#b452cd>3</span> --sort=rate -p https --save /etc/pacman.d/mirrorlist
</span></span></code></pre></div><p>上述命令用于测试并挑选出下载速率最快的、所属中国区并使用 HTTPS 协议的三个源，并将其写入配置文件中。
如此一来，就不会因为下载速度而影响安装速度了。</p><blockquote><p>注意，由于 ARCH 的软件更新非常频繁，各大镜像节点速度的限制，安装时有可能出现找不到软件包的 404 报错，稍候再试即可。</p></blockquote><h2 id=硬盘分区>硬盘分区</h2><p>首先需要查看系统分区信息</p><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lsblk
</span></span></code></pre></div><p>输出的内容类似于</p><pre tabindex=0><code>NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda           8:0    0 931.5G  0 disk
└─sda1        8:1    0 931.5G  0 part
nvme0n1     259:0    0 953.9G  0 disk
├─nvme0n1p1 259:1    0   565M  0 part
├─nvme0n1p2 259:2    0 100.6G  0 part
├─nvme0n1p3 259:3    0   101G  0 part
├─nvme0n1p4 259:4    0 750.9G  0 part
└─nvme0n1p5 259:5    0  1003M  0 part
</code></pre><p>我系统的分区如上， <code>nvme0n1p1</code> 是 <code>UEFI</code> 分区， <code>nvme0n1p2</code> 是 WIN10 所在分区， <code>nvme0n1p3</code> 将用于安装 ARCH， <code>nvme0n1p4</code> 用于存储数据。</p><p>双系统可以在 WIN10 下使用磁盘管理器先调整好分区，也可以使用 ARCH 提供的 <code>cfdisk</code> 来进行可视化分区。必须要记住的是，至少要分一个 <code>EFI System</code> 分区和一个 <code>Linux File System</code> 分区。</p><blockquote><p>根据网上资料，EFI 分区至少要保证有 500MB 容量。</p></blockquote><p>分区完成后，使用 Linux 命令对分区进行格式化</p><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#228b22>#格式化EFI分区</span>
</span></span><span style=display:flex><span>mkfs.fat -F <span style=color:#b452cd>32</span> /dev/nvme0n1p1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22>#格式化Linux分区</span>
</span></span><span style=display:flex><span>mkfs.ext4 /dev/nvme0n1p3
</span></span></code></pre></div><blockquote><p>存储设备在未挂载到系统前，都以设备文件的形式存在于 <code>/dev</code> 路径下，格式化之前可以先挂载到系统检查下。</p></blockquote><h2 id=安装基础系统>安装基础系统</h2><p>首先挂载系统分区</p><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mount /dev/nvme0n1p3 /mnt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir /mnt/boot
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mount /dev/nvme0n1p1 /mnt/boot
</span></span></code></pre></div><p>将系统分区挂载到 <code>/mnt</code> ，然后手动创建 <code>/mnt/boot</code> ，再将引导分区挂载过去。
然后只需简单的执行 <code>pacstrap /mnt base</code> 即可自动安装系统。</p><blockquote><p>可选的 <code>base-devel</code> 用于支撑 <code>AUR</code> 上的软件包的本地编译。</p></blockquote><p>当命令执行完毕后，需要更新 <code>fstab</code> 文件</p><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>genfstab -U /mnt /mnt/etc/fstab
</span></span></code></pre></div><p>最后需要安装 <code>systemd-boot</code> 引导，但是留到下一节写吧。</p><h2 id=初始化系统>初始化系统</h2><p>通过执行 <code>arch-chroot /mnt</code> 切换到刚安装好的系统中，然后我需要对系统做一些初始的操作，以便第一次启动能够正常运行</p><h3 id=安装-uefi-引导>安装 UEFI 引导</h3><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bootctl --path=/boot installl
</span></span></code></pre></div><p>简单快捷，装好了，但是还没彻底完成，需要手动处理配置文件（这点没有 GRUB 省心）。</p><blockquote><p>注意，双系统在执行上述命令前需要安装 <code>efibootmgr</code> 软件来检测开机引导信息。</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp /usr/share/systemd/bootctl/arch.conf /boot/loader/entries/
</span></span></code></pre></div><p>将内置的配置模板拷贝到配置文件目录下，然后执行 <code>blkid /dev/nvme0n1p3</code> 查询系统所在分区的 UUID。</p><p>修改上述配置文件中的 <code>PARTUUID</code> 为分区的 UUID，将 <code>rootfstype</code> 改为 <code>ext4</code> 。</p><p>最后，执行</p><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkinitcpio -p linux
</span></span></code></pre></div><p>生成初始内存盘。</p><h3 id=设置主机名>设置主机名</h3><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#658b00>echo</span> laptop &gt; /etc/hostname
</span></span></code></pre></div><h3 id=设置时区>设置时区</h3><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></span></code></pre></div><h3 id=创建个人账户>创建个人账户</h3><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>useradd -m -G users,wheel -s /bin/bash laeo
</span></span></code></pre></div><h3 id=修改登录密码>修改登录密码</h3><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>passwd root
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>passwd laeo
</span></span></code></pre></div><h3 id=安装基础程序>安装基础程序</h3><div class=highlight><pre tabindex=0 style=background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pacman -S vim git dialog wpa_supplicant wireless_tools sudo
</span></span></code></pre></div><h3 id=设置账户权限>设置账户权限</h3><p>执行 <code>vim /etc/sudoers</code> 并删除文件中 <code>%wheel</code> 前的注释符，现在所有处于 <code>wheel</code> 用户组的账号都可以使用 <code>sudo</code> 命令来调用管理员权限了。</p><h3 id=重启系统>重启系统</h3><p>至此，整个安装流程就基本完成了，所有操作都可以从 ARCH 官方 WIKI 中找到。</p><h2 id=其它>其它</h2><h3 id=安装桌面环境>安装桌面环境</h3><p>重启后还是一块黑白屏，我需要图形界面！</p><p>图形界面我个人习惯 <code>KDE</code> 和 <code>DDE</code> ，两者皆是开源产物，只不过后者是国内企业开发并开源的，所以后者对国内软件支持比较优秀。</p><p>无论哪一个，都需要安装最基础的 <code>xorg-server</code> 全家桶，当然你也可以使用 <code>wayland</code> ，但是 DDE 目前为止不支持，理由是不够稳定。</p><p>安装非常简单，依照 ARCH WIKI 中的指导一步步安装就行了，懒得写了。</p><h3 id=英伟达易爆炸>英伟达“易爆炸”</h3><p>双显卡机器安装 Linux 很容易遇到双显卡引起的各种扯淡毛病，我自己就遇到过各种各样的。</p><p>有系统的安装环境是图形界面，加载不进去。有的装好了系统，开机黑屏。有的开机进了登录界面，刚登录进桌面就卡死。</p><p>各种搜索，无非就是内核参数加 <code>nomodeset</code> ，屏蔽开源独显驱动 <code>nouveau</code> ，甚至还有疯到让屏蔽集显驱动的……</p><p>我都试了，没用， <code>lspci</code> 执行就卡死。后来在 Gayhub 搜到个 <a href=https://github.com/Bumblebee-Project/Bumblebee/issues/764#issuecomment-234494238>Issue</a>，照着回复里尝试加了内核参数后，总算不卡死了。</p><p>现在我是每天开电脑第一件事，就是执行 <code>sudo pacman -Syyu</code> 滚动更新，我等着下一次的“卡死”。</p><hr width=100% id=EOF><p style=color:#777>最后修改于 2018-06-13</p></div></div><nav class=post-pagination><a class=newer-posts href=/linux/arch%E5%AE%89%E8%A3%85plasma%E6%A1%8C%E9%9D%A2%E7%8E%AF%E5%A2%83%E5%8F%8A%E7%BE%8E%E5%8C%96%E8%AE%B0%E5%BD%95/>下回<br>ARCH安装Plasma桌面环境及美化记录
</a><a class=older-posts href=/linux/%E6%B7%B1%E5%BA%A6linux%E4%B8%8Bss%E6%99%BA%E8%83%BD%E5%88%86%E6%B5%81/>上回<br>深度Linux下SS智能分流</a></nav><div class=post-comment-wrapper><div id=gitalk-container></div></div></div></div></div></div><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://laeo.github.io/><div class=nav-title>LAEO</div><div class=nav-subtitle>桀桀桀</div></a><div class=nav-link-list></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>移植自 <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
2020 LAEO</div></div><div id=extraContainer class=extra-container><div class=toc-wrapper><div class=toc><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e5%88%b6%e4%bd%9c%e5%ae%89%e8%a3%85%e7%9b%98 class=nav-制作安装盘>制作安装盘</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e5%ae%89%e8%a3%85%e7%8e%af%e5%a2%83 class=nav-设置安装环境>设置安装环境</a></li><li><a href=#%e7%a1%ac%e7%9b%98%e5%88%86%e5%8c%ba class=nav-硬盘分区>硬盘分区</a></li><li><a href=#%e5%ae%89%e8%a3%85%e5%9f%ba%e7%a1%80%e7%b3%bb%e7%bb%9f class=nav-安装基础系统>安装基础系统</a></li><li><a href=#%e5%88%9d%e5%a7%8b%e5%8c%96%e7%b3%bb%e7%bb%9f class=nav-初始化系统>初始化系统</a></li><ul><li><a href=#%e5%ae%89%e8%a3%85-uefi-%e5%bc%95%e5%af%bc class=nav-安装-uefi-引导>安装 UEFI 引导</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e4%b8%bb%e6%9c%ba%e5%90%8d class=nav-设置主机名>设置主机名</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e6%97%b6%e5%8c%ba class=nav-设置时区>设置时区</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e4%b8%aa%e4%ba%ba%e8%b4%a6%e6%88%b7 class=nav-创建个人账户>创建个人账户</a></li><li><a href=#%e4%bf%ae%e6%94%b9%e7%99%bb%e5%bd%95%e5%af%86%e7%a0%81 class=nav-修改登录密码>修改登录密码</a></li><li><a href=#%e5%ae%89%e8%a3%85%e5%9f%ba%e7%a1%80%e7%a8%8b%e5%ba%8f class=nav-安装基础程序>安装基础程序</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e8%b4%a6%e6%88%b7%e6%9d%83%e9%99%90 class=nav-设置账户权限>设置账户权限</a></li><li><a href=#%e9%87%8d%e5%90%af%e7%b3%bb%e7%bb%9f class=nav-重启系统>重启系统</a></li></ul><li><a href=#%e5%85%b6%e5%ae%83 class=nav-其它>其它</a></li><ul><li><a href=#%e5%ae%89%e8%a3%85%e6%a1%8c%e9%9d%a2%e7%8e%af%e5%a2%83 class=nav-安装桌面环境>安装桌面环境</a></li><li><a href=#%e8%8b%b1%e4%bc%9f%e8%be%be%e6%98%93%e7%88%86%e7%82%b8 class=nav-英伟达易爆炸>英伟达“易爆炸”</a></li></ul></div></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up
</i></a><a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>移植自 <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
2020 LAEO</div></div><script src=/js/journal.js></script></body></html>