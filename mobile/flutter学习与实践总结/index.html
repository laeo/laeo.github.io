<!doctype html><html lang=zh><head><title>Flutter学习与实践总结</title>
<meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=5" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><link rel=icon href=https://laeo.github.io/favicon.ico><script src=/js/toc.js></script><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=stylesheet href=/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media=screen><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Material+Icons"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script src=/vendor/js/md5.min.js></script><script>var gitalk=new Gitalk({clientID:"bcb3ff802edb45ae15c3",clientSecret:"541b0675cacbdad87ef5e31dcff14d28f843b34a",repo:"laeo.github.io",owner:"laeo",admin:["laeo"],id:md5(location.pathname),distractionFreeMode:"false"});window.onload=function(){gitalk.render("gitalk-container")}</script></head><body><div id=app><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><div class=toc><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e9%97%b2%e8%a8%80 class=nav-闲言>闲言</a></li><li><a href=#%e5%ad%a6%e4%b9%a0%e8%ae%b0%e5%bd%95 class=nav-学习记录>学习记录</a></li><ul><ul><li><a href=#%e5%ae%89%e8%a3%85-flutter class=nav-安装-flutter>安装 Flutter</a></li><li><a href=#dart-%e4%b8%8e-widget class=nav-dart-与-widget>Dart 与 Widget</a></li><li><a href=#%e5%b8%83%e5%b1%80%e4%b8%8e%e6%8e%92%e7%89%88 class=nav-布局与排版>布局与排版</a></li><li><a href=#%e6%a0%b7%e5%bc%8f class=nav-样式>样式</a></li><li><a href=#canvas class=nav-canvas>Canvas</a></li></ul></ul><li><a href=#%e6%a7%bd%e7%82%b9 class=nav-槽点>槽点</a></li><ul><ul><li><a href=#%e7%b3%bb%e7%bb%9f%e6%9d%83%e9%99%90 class=nav-系统权限>系统权限</a></li><li><a href=#%e6%9c%ac%e5%9c%b0%e5%8c%96 class=nav-本地化>本地化</a></li><li><a href=#%e5%90%84%e7%a7%8d%e5%ba%93%e7%bc%ba%e5%a4%b1 class=nav-各种库缺失>各种库缺失</a></li></ul></ul><li><a href=#%e6%b0%b4%e5%8d%b0-app class=nav-水印-app>水印 APP</a></li><li><a href=#%e6%80%bb%e7%bb%93 class=nav-总结>总结</a></li></ul></div></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu
</i></button>
<a id=navTitle class=navbar-brand href=https://laeo.github.io/>LAEO
</a><button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://laeo.github.io/><div class=single-column-header-title>LAEO</div><div class=single-column-header-subtitle>桀桀桀</div></a></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>Flutter学习与实践总结<div class=post-meta><time itemprop=datePublished>2020-09-11 00:00
</time><i class=material-icons>schedule</i>
9 min
30 s.</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><h2 id=闲言>闲言</h2><p>Flutter 可以说在开发者圈子还是很有名的了，毕竟是谷歌，关注度自不必说。我很早就有心涉足移动 APP 开发，但是学习了一段时间的安卓开发后，实在忍受不了 JAVA 那种类中套类的套娃写法（也可能是没学对吧），后面就没坚持下去。做过一段时间的小程序开发后，又让我燃起了对原生移动端的热情，于是我打开了 Flutter 的官网……</p><h2 id=学习记录>学习记录</h2><p>学习方法很重要，对于我这个大部分靠自学的人而言，最好的办法肯定就是先速览一遍文档，对要学习的内容有个大致的印象，然后跟着教程挨个阅读、实践，增强对细节的记忆与理解。</p><h4 id=安装-flutter>安装 Flutter</h4><p>我用的是 Mac，所以安装时走的包管理器，并没有依照文档中那样下载二进制文件。所以总的来说安装还是很简单的，首先 <code>brew install flutter</code> ，安装好二进制，然后执行 <code>flutter docter</code> 检查环境及依赖。</p><p>无论使用什么编辑器编写代码，<strong>Android Studio</strong> 以及 <strong>Xcode</strong> 都是必须的，为了方便调试，还需要创建各平台的虚拟机。对于我来说，<strong>VSCode</strong> 搭配 Flutter 相关的插件就已经满足开发调试的需要，而且还可以直接吊起双端的虚拟机进行调试，简直方便到不行。</p><h4 id=dart-与-widget>Dart 与 Widget</h4><p>了解 Flutter 的都知道，谷歌为它选择了一门冷门语言 —— Dart。这门语言对于熟悉 JS 和 TS 的人来说，上手难度不大。入口函数 <code>void main()</code> 、类、接口、范型、异步，主要是看下异步那块的文档，其它的都大同小异。Widget 的话，类似 Vue 和 React 里的组件，Flutter 渲染界面就是通过我们传递给 <code>runApp()</code> 函数的组件实例开始的，所以我们开发时会经常跟各种 Widget 打交道。</p><p>Flutter 把 Widget 分为两种类型，即 <strong>StatefullWidget</strong> 和 <strong>StatelessWidget</strong>，我们要创建自定义的组件，也是通过继承这两个组件类来完成的。看到 <code>Statefull</code> 和 <code>Stateless</code> ，如果熟悉 Kubernetes 的话，一定会有所联想。确实，与 K8S 中的定义类似，它们也是用于区分组件自身是否需要维护一个状态的，具体两种组件在渲染时有何差异，我还并未去了解，想来应该是用于拆分代码结构、确定组件是否需要重建用的吧。</p><p>另外，需要注意的是，虽然 runApp() 函数接收一个组件，但不代表组件就是被渲染到屏幕上的具体元素。按文档所言，Widget 主要是用来存储渲染结果的配置信息的，也就是说它只是个配置信息容器。实际代表渲染结果的，是 Element 类实例。Widget 中的配置信息，决定了 Element 最终以何等形式显示在屏幕上。另外，Widget 中的 build 方法所接收的参数 context，实际上就是 Element 的实例。</p><h4 id=布局与排版>布局与排版</h4><p>Flutter 提供了类似现代 Web 形式的布局与排版方式，比如熟悉的 Flex 布局系统，还有基于 Flex 布局的 <code>Row</code> 和 <code>Column</code> 组件，简直不要太方便。对于展示需要垂直或者水平滚动的内容，Flutter 内置了 <code>SingleChildScrollViewWidget</code> 、 <code>MultiChildScrollViewWidget</code> 两个组件，还有如 <code>Container</code> <code>Stack</code> <code>Positioned</code> <code>Expanded</code> <code>Text</code> 之类的组件，轻松处理各种布局。</p><h4 id=样式>样式</h4><p>谷歌出品，必须质感。<strong>Material</strong> 不出意外的成为默认设计风格，当然为了兼容苹果设备，谷歌另外提供了一套风格组件 <strong>Cupertino</strong>。当然现代移动 APP 应用都很难说清自己用了什么风格，或许都沾一点，也不要紧，自己动手修改组件的参数就行。</p><h4 id=canvas>Canvas</h4><p>为啥要单独提出来说呢？因为它给我的印象最深。我练手写的 APP，是一款图片加水印的 APP，用于各种证件照片打水印。Flutter 没有内置的操作处理图片的库，也没有找到相关的三方库，唯一找到的一个 <strong>image</strong> 还因为各种原因不适用。所以找来找去，找到了 <code>CustomPaint</code> ，因为要实时预览最终的图片效果，所以只能自己写一个 <code>CustomPainter</code> 来实现图片打水印的逻辑。</p><p>说起这个 CustomPaint Widget，那就不知道要说些啥了，反正很强大，搭配自定义的 CustomPainter，可以为用户呈现任意图形，甚至是动画。而其依赖的 CustomPainter 实现，则是通过 <strong>Canvas</strong> 来达到构造任意图形的功能，只是由于 Canvas 的 API 设计没有对象化，所以用起来还是挺烧脑的，特别是我这种没有过 Canvas 绘制经验的人……</p><h2 id=槽点>槽点</h2><p>由于我没做过原生相关开发，所以某些观点可能存在差错。</p><h4 id=系统权限>系统权限</h4><p>这一点说实话 Flutter 没做好，依然还要手动修改原生配置文件来申请权限，虽然有一个开源的库可以辅助，但仍需要手动修改配置。按我所设想，它完全可以用配置文件加代码生成的方式，来达成权限申请的统一管理，隔离开发者与原生配置文件。</p><h4 id=本地化>本地化</h4><p>Flutter 的本地化，并没有包括应用在启动器里的名字，让我很差异……其实也可以通过代码生成的方式来处理这个问题。</p><h4 id=各种库缺失>各种库缺失</h4><p>可能是因为 Dart 这个语言的定位问题，Flutter 的各种库（比如图片、视频）都是依靠第三方开发，没有自己实现的。这意味着不稳定、更新不及时、兼容性无法保证等问题。比如我找一个将图片保存到系统相册的库，尝试了好几个都不行，有的是权限问题，有的是原生代码老旧，最后还是找了一个别人修改过的版本，才能正常使用。</p><h2 id=水印-app>水印 APP</h2><p>我开发的 APP 已开源，地址是 <a href=https://github.com/laeo/flutter-watermark>laeo/flutter-watermark</a>。大致的逻辑就是自定义 CustomPainter 根据传入的参数绘制水印图，画布的大小根据传入的 <code>Size</code> 来定。当用于界面展示时就根据容器宽度，保持与图片相同宽高比计算画布的宽高，图片使用 <code>BoxFit.cover</code> 约束填充到画布上。而当用户点击保存按钮时，传入的 <code>Size</code> 直接使用图片本身的宽高，以保证清晰度。</p><h2 id=总结>总结</h2><p>就目前我的开发体验来说，Flutter 的路还很长，虽然现在有部分公司开始使用，特别是像咸鱼团队这种主推它的，可依然无法避免开发过程中需要与原生打交道的时候。对于开发一些小型的 APP，或者技术团队足够强的企业，或许会省事一些，希望以后会更加完善吧。</p><hr width=100% id=EOF><p style=color:#777>最后修改于 2020-09-11</p></div></div><nav class=post-pagination><a class=newer-posts href=/golang/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%A4%B1%E8%B4%A5%E5%88%B0%E8%BF%9E%E9%9D%A2%E8%AF%95%E9%A2%98%E9%83%BD%E6%B2%A1%E8%BF%87%E5%8E%BB%E7%9A%84go%E8%AF%AD%E8%A8%80%E9%9D%A2%E8%AF%95/>下回<br>记一次失败到连面试题都没过去的Go语言面试
</a><a class=older-posts href=/golang/go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/>上回<br>Go 语言中的依赖注入解决方案</a></nav><div class=post-comment-wrapper><div id=gitalk-container></div></div></div></div></div></div><div id=sideContainer class=side-container><a class="a-block nav-head false" href=https://laeo.github.io/><div class=nav-title>LAEO</div><div class=nav-subtitle>桀桀桀</div></a><div class=nav-link-list></div><div class=nav-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>移植自 <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
2020 LAEO</div></div><div id=extraContainer class=extra-container><div class=toc-wrapper><div class=toc><div class=toc-content><center>- 目录 -</center><ul><ul><li><a href=#%e9%97%b2%e8%a8%80 class=nav-闲言>闲言</a></li><li><a href=#%e5%ad%a6%e4%b9%a0%e8%ae%b0%e5%bd%95 class=nav-学习记录>学习记录</a></li><ul><ul><li><a href=#%e5%ae%89%e8%a3%85-flutter class=nav-安装-flutter>安装 Flutter</a></li><li><a href=#dart-%e4%b8%8e-widget class=nav-dart-与-widget>Dart 与 Widget</a></li><li><a href=#%e5%b8%83%e5%b1%80%e4%b8%8e%e6%8e%92%e7%89%88 class=nav-布局与排版>布局与排版</a></li><li><a href=#%e6%a0%b7%e5%bc%8f class=nav-样式>样式</a></li><li><a href=#canvas class=nav-canvas>Canvas</a></li></ul></ul><li><a href=#%e6%a7%bd%e7%82%b9 class=nav-槽点>槽点</a></li><ul><ul><li><a href=#%e7%b3%bb%e7%bb%9f%e6%9d%83%e9%99%90 class=nav-系统权限>系统权限</a></li><li><a href=#%e6%9c%ac%e5%9c%b0%e5%8c%96 class=nav-本地化>本地化</a></li><li><a href=#%e5%90%84%e7%a7%8d%e5%ba%93%e7%bc%ba%e5%a4%b1 class=nav-各种库缺失>各种库缺失</a></li></ul></ul><li><a href=#%e6%b0%b4%e5%8d%b0-app class=nav-水印-app>水印 APP</a></li><li><a href=#%e6%80%bb%e7%bb%93 class=nav-总结>总结</a></li></ul></div></div></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up
</i></a><a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><div id=single-column-footer>Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a> by <a href=https://risehere.net/>Rise</a><br>移植自 <a href=https://mak1t0.cc/ target=_blank rel="noreferrer noopener">Makito</a>'s <a href=https://github.com/SumiMakito/hexo-theme-journal/ target=_blank rel="noreferrer noopener">Journal.</a><br><br>&copy;
2020 LAEO</div></div><script src=/js/journal.js></script></body></html>